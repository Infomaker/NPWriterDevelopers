<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>packages/dialog/DialogComponent.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Api.html">Api</a><ul class='methods'><li data-type='method'><a href="Api.html#call">call</a></li><li data-type='method'><a href="Api.html#getConfigValue">getConfigValue</a></li><li data-type='method'><a href="Api.html#init">init</a></li></ul></li><li><a href="APIManager.html">APIManager</a><ul class='methods'><li data-type='method'><a href="APIManager.html#expose">expose</a></li></ul></li><li><a href="Article.html">Article</a><ul class='methods'><li data-type='method'><a href="Article.html#clear">clear</a></li><li data-type='method'><a href="Article.html#copy">copy</a></li></ul></li><li><a href="Browser.html">Browser</a><ul class='methods'><li data-type='method'><a href="Browser.html#getHash">getHash</a></li><li data-type='method'><a href="Browser.html#isSupported">isSupported</a></li><li data-type='method'><a href="Browser.html#reload">reload</a></li><li data-type='method'><a href="Browser.html#setHash">setHash</a></li><li data-type='method'><a href="Browser.html#setupHashHandler">setupHashHandler</a></li></ul></li><li><a href="Concept.html">Concept</a><ul class='methods'><li data-type='method'><a href="Concept.html#.getDefinitionForType">getDefinitionForType</a></li><li data-type='method'><a href="Concept.html#.setDefinitionDependingOnArrayOrObject">setDefinitionDependingOnArrayOrObject</a></li></ul></li><li><a href="Document.html">Document</a><ul class='methods'><li data-type='method'><a href="Document.html#deleteNode">deleteNode</a></li><li data-type='method'><a href="Document.html#getDocumentNodes">getDocumentNodes</a></li><li data-type='method'><a href="Document.html#handleDrag">handleDrag</a></li><li data-type='method'><a href="Document.html#insertBlockNode">insertBlockNode</a></li><li data-type='method'><a href="Document.html#insertInlineNode">insertInlineNode</a></li></ul></li><li><a href="Events.html">Events</a><ul class='methods'><li data-type='method'><a href="Events.html#_triggerEvent">_triggerEvent</a></li><li data-type='method'><a href="Events.html#documentChanged">documentChanged</a></li><li data-type='method'><a href="Events.html#documentIsUnsaved">documentIsUnsaved</a></li><li data-type='method'><a href="Events.html#documentSaved">documentSaved</a></li><li data-type='method'><a href="Events.html#documentSaveFailed">documentSaveFailed</a></li><li data-type='method'><a href="Events.html#off">off</a></li><li data-type='method'><a href="Events.html#on">on</a></li><li data-type='method'><a href="Events.html#onDocumentStartSaving">onDocumentStartSaving</a></li><li data-type='method'><a href="Events.html#triggerEvent">triggerEvent</a></li></ul></li><li><a href="FormSearchComponent.html">FormSearchComponent</a><ul class='methods'><li data-type='method'><a href="FormSearchComponent.html#getCreateNewItem">getCreateNewItem</a></li></ul></li><li><a href="LabelProvider.html">LabelProvider</a></li><li><a href="NewsItem.html">NewsItem</a><ul class='methods'><li data-type='method'><a href="NewsItem.html#_getItemMetaExtPropertyByType">_getItemMetaExtPropertyByType</a></li><li data-type='method'><a href="NewsItem.html#_getLinksByType">_getLinksByType</a></li><li data-type='method'><a href="NewsItem.html#_getSignalNodeByQcode">_getSignalNodeByQcode</a></li><li data-type='method'><a href="NewsItem.html#addAuthor">addAuthor</a></li><li data-type='method'><a href="NewsItem.html#addCategory">addCategory</a></li><li data-type='method'><a href="NewsItem.html#addChannel">addChannel</a></li><li data-type='method'><a href="NewsItem.html#addConceptProfile">addConceptProfile</a></li><li data-type='method'><a href="NewsItem.html#addLink">addLink</a></li><li data-type='method'><a href="NewsItem.html#addLocation">addLocation</a></li><li data-type='method'><a href="NewsItem.html#addSimpleAuthor">addSimpleAuthor</a></li><li data-type='method'><a href="NewsItem.html#addStory">addStory</a></li><li data-type='method'><a href="NewsItem.html#addTag">addTag</a></li><li data-type='method'><a href="NewsItem.html#createNewsPriority">createNewsPriority</a></li><li data-type='method'><a href="NewsItem.html#getAuthors">getAuthors</a></li><li data-type='method'><a href="NewsItem.html#getCategories">getCategories</a></li><li data-type='method'><a href="NewsItem.html#getChannels">getChannels</a></li><li data-type='method'><a href="NewsItem.html#getContentProfiles">getContentProfiles</a></li><li data-type='method'><a href="NewsItem.html#getGuid">getGuid</a></li><li data-type='method'><a href="NewsItem.html#getLinkByType">getLinkByType</a></li><li data-type='method'><a href="NewsItem.html#getLinkByTypeAndRel">getLinkByTypeAndRel</a></li><li data-type='method'><a href="NewsItem.html#getLinksByType">getLinksByType</a></li><li data-type='method'><a href="NewsItem.html#getLocations">getLocations</a></li><li data-type='method'><a href="NewsItem.html#getMainChannel">getMainChannel</a></li><li data-type='method'><a href="NewsItem.html#getNewsPriority">getNewsPriority</a></li><li data-type='method'><a href="NewsItem.html#getPubStart">getPubStart</a></li><li data-type='method'><a href="NewsItem.html#getPubStatus">getPubStatus</a></li><li data-type='method'><a href="NewsItem.html#getPubStop">getPubStop</a></li><li data-type='method'><a href="NewsItem.html#getStories">getStories</a></li><li data-type='method'><a href="NewsItem.html#getTags">getTags</a></li><li data-type='method'><a href="NewsItem.html#isValid">isValid</a></li><li data-type='method'><a href="NewsItem.html#normalizeObject">normalizeObject</a></li><li data-type='method'><a href="NewsItem.html#removeAuthorByTitle">removeAuthorByTitle</a></li><li data-type='method'><a href="NewsItem.html#removeAuthorByUUID">removeAuthorByUUID</a></li><li data-type='method'><a href="NewsItem.html#removeChannel">removeChannel</a></li><li data-type='method'><a href="NewsItem.html#removeLinkByUUID">removeLinkByUUID</a></li><li data-type='method'><a href="NewsItem.html#removeLinkByUUIDAndRel">removeLinkByUUIDAndRel</a></li><li data-type='method'><a href="NewsItem.html#removePubStart">removePubStart</a></li><li data-type='method'><a href="NewsItem.html#removePubStop">removePubStop</a></li><li data-type='method'><a href="NewsItem.html#save">save</a></li><li data-type='method'><a href="NewsItem.html#setGuid">setGuid</a></li><li data-type='method'><a href="NewsItem.html#setNewsPriority">setNewsPriority</a></li><li data-type='method'><a href="NewsItem.html#setPubStart">setPubStart</a></li><li data-type='method'><a href="NewsItem.html#setPubStatus">setPubStatus</a></li><li data-type='method'><a href="NewsItem.html#setPubStop">setPubStop</a></li><li data-type='method'><a href="NewsItem.html#setSource">setSource</a></li><li data-type='method'><a href="NewsItem.html#updateConceptProfile">updateConceptProfile</a></li><li data-type='method'><a href="NewsItem.html#updateLocation">updateLocation</a></li><li data-type='method'><a href="NewsItem.html#updateStory">updateStory</a></li><li data-type='method'><a href="NewsItem.html#updateTag">updateTag</a></li></ul></li><li><a href="NewsMLArticle.html">NewsMLArticle</a></li><li><a href="NewsMLImporter.html">NewsMLImporter</a><ul class='methods'><li data-type='method'><a href="NewsMLImporter.html#getFirstElementWithTypeElement">getFirstElementWithTypeElement</a></li></ul></li><li><a href="NotFoundException.html">NotFoundException</a></li><li><a href="PluginManager.html">PluginManager</a><ul class='methods'><li data-type='method'><a href="PluginManager.html#_getValue">_getValue</a></li><li data-type='method'><a href="PluginManager.html#appendPluginScripts">appendPluginScripts</a></li><li data-type='method'><a href="PluginManager.html#getListOfPlugins">getListOfPlugins</a></li><li data-type='method'><a href="PluginManager.html#load">load</a></li><li data-type='method'><a href="PluginManager.html#registerPlugin">registerPlugin</a></li><li data-type='method'><a href="PluginManager.html#validatePluginPackage">validatePluginPackage</a></li></ul></li><li><a href="Router.html">Router</a><ul class='methods'><li data-type='method'><a href="Router.html#ajax">ajax</a></li><li data-type='method'><a href="Router.html#checkForOKStatus">checkForOKStatus</a></li><li data-type='method'><a href="Router.html#get">get</a></li><li data-type='method'><a href="Router.html#getConceptItem">getConceptItem</a></li><li data-type='method'><a href="Router.html#getEndpoint">getEndpoint</a></li><li data-type='method'><a href="Router.html#getNewsItem">getNewsItem</a></li><li data-type='method'><a href="Router.html#post">post</a></li><li data-type='method'><a href="Router.html#postBinary">postBinary</a></li><li data-type='method'><a href="Router.html#proxy">proxy</a></li><li data-type='method'><a href="Router.html#put">put</a></li><li data-type='method'><a href="Router.html#toJson">toJson</a></li></ul></li><li><a href="Ui.html">Ui</a><ul class='methods'><li data-type='method'><a href="Ui.html#showDialog">showDialog</a></li><li data-type='method'><a href="Ui.html#showMessageDialog">showMessageDialog</a></li><li data-type='method'><a href="Ui.html#showNotification">showNotification</a></li></ul></li><li><a href="Upload.html">Upload</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">packages/dialog/DialogComponent.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {Component, FontAwesomeIcon} from 'substance'
import Event from '../../utils/Event'

class DialogComponent extends Component {

    constructor(...args) {
        super(...args)

        // When esc:pressed event close the dialog
        this.context.api.events.on('__dialog', 'keypressed:esc', () => {
            this.close()
        })

        // action handlers
        this.handleActions({
            'close': this.close,
            'dialog:enablePrimaryBtn': this.enablePrimaryBtn,
            'dialog:disablePrimaryBtn': this.disablePrimaryBtn
        });
    }



    didMount() {

        this.changeModalHeight()

        window.onresize = () => {
            this.changeModalHeight()
        }
    }

    dispose() {
        window.onresize = null
    }

    enablePrimaryBtn() {
        this.extendState({
            primaryBtnEnabled: true
        })
    }

    disablePrimaryBtn() {
        this.extendState({
            primaryBtnEnabled: false
        })
    }

    getInitialState() {
        return {
            primaryBtnEnabled: true
        }
    }

    render($$) {

        /**
         * [
         {
           "type": "info",
           "message": "This is a info message."
         },
         {
           "type": "warning",
           "message": "This is a warning message."
         },
         {
           "type": "error",
           "message": "Artikeln saknar titel vilket kan göra den svår att hitta."
         }
         ]
         */

        const props = this.props;
        const options = props.options;

        const modal = $$('div').attr('id', 'im-modal-default').addClass('modal').ref('modal')

        const modalDialog = $$('div').addClass('modal-dialog').attr('role', 'document');
        const modalContent = $$('div').addClass('modal-content');

        const modalBody = $$('div').addClass('modal-body');
        const modalFooter = $$('div').addClass('modal-footer');

        const contentComponent = props.content;
        const modalInnerContent = $$(contentComponent, props.contentProps).addClass('modal-inner-content').ref('contentComponent')

        if(options.takeover) {
            modal.addClass('global takeover')
        }

        modalBody.append(modalInnerContent)
        this.addPrimaryButtonIfExist($$, modalFooter, options)
        this.addSecondaryButtonIfExist($$, modalFooter, options)
        this.addTertiaryButtons($$, modalFooter, options)
        this.addTitleIfExist($$, modalContent, options)

        modalContent.append([modalBody, modalFooter])

        modalDialog.append(modalContent)
        modal.append(modalDialog);

        return modal
    }

    /**
     * If a title is provided in the options object it will create a
     * modal-header and append provided title through the label system
     * @param $$
     * @param modalContent
     * @param options
     */
    addTitleIfExist($$, modalContent, options) {
        if (options.title) {
            modalContent.append(
                $$('div').addClass('modal-header').append(
                    $$('h2').append(
                        this.getLabel(options.title)
                    )
                )
            );
        }
    }


    /**
     * Recalculate the height of the modal window depending on the resolution on the client.innerHeight
     */
    changeModalHeight() {
        var clientHeight = window.innerHeight;
        if (clientHeight &lt; 700) {
            this.el.find('.modal-content').addClass('small-screen');
            this.el.find('.modal-content').css('height', (parseInt(clientHeight - 60, 10))+"px")
        } else {
            this.el.find('.modal-content').removeClass('small-screen');
            this.el.find('.modal-content').css('max-height', clientHeight - 120+"px");
            this.el.find('.modal-content').css('height', 'auto')
        }
    }


    addPrimaryButtonIfExist($$, modalFooter, options) {
        if (options.primary !== false) {
            modalFooter.append(this.renderPrimaryButton($$, options).ref('primaryButton'));
        }
    }

    addSecondaryButtonIfExist($$, modalFooter, options) {
        if (options.secondary !== false) {
            modalFooter.append(this.renderSecondaryButton($$, options).ref('secondaryButton'));
        }
    }

    addTertiaryButtons($$, modalFooter, options) {
        if (options.tertiary) {
            modalFooter.append(this.renderTertiaryButtons($$, options));
        }
    }

    save() {
        if (this.state.primaryBtnEnabled) {
            this.showPrimaryButtonLoader();
            if (this.refs.contentComponent.onClose &amp;&amp; this.refs.contentComponent.onClose('save') !== false) {
                this.send(Event.DIALOG_CLOSE) // Send this close to Writer can reset state
                this.remove();
            }
        }
    }

    close() {
        if (this.refs.contentComponent.onClose &amp;&amp; this.refs.contentComponent.onClose('cancel') !== false) {
            this.send(Event.DIALOG_CLOSE) // Send this close to Writer can reset state
            this.remove();
        }
    }

    showPrimaryButtonLoader() {
        this.refs.primaryButton.el.text("").addClass('disabled');
        // this.refs.primaryButton.append(this.$$(FontAwesomeIcon, {icon: 'fa-spinner fa-spin'}));
    }

    renderPrimaryButton($$, options) {
        var caption = (options.primary) ? options.primary : this.getLabel('ok');
        let button = $$('button').attr('type', 'button')
            .addClass('btn sc-np-btn btn-primary')
            .append(caption)
            .on('click', this.save);

        if (!this.state.primaryBtnEnabled) {
            button.attr('disabled', true)
        }

        return button
    }

    renderSecondaryButton($$, options) {
        var caption = (options.secondary) ? options.secondary : this.getLabel('Cancel');
        return $$('button').attr('type', 'button')
            .addClass('btn sc-np-btn btn-secondary')
            .attr('data-dismiss', 'modal')
            .append(caption)
            .on('click', this.close);
    }

    renderTertiaryButtons($$, options) {
        if (!Array.isArray(options.tertiary)) {
            return $$('span');
        }

        return options.tertiary.map((btn) => {
            return $$('button').attr('type', 'button')
                .addClass('btn sc-np-btn btn-secondary btn-tertiary')
                .attr('data-dismiss', 'modal')
                .append(btn.caption)
                .on('click', () => {
                    var ret = btn.callback();
                    if (ret === true) {
                        this.close();
                    }
                })

        })
    }
}

export default DialogComponent</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue Nov 15 2016 22:32:01 GMT+0100 (CET) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
