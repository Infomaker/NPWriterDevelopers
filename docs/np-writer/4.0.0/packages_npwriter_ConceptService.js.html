<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>packages/npwriter/ConceptService.js - Documentation</title>
    <script src="scripts/prettify/prettify.js"></script>
    <!-- <link rel="stylesheet" href="styles/prism.css"> -->
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul class=namespaces><li><a href="Api.html">Api</a></li><li><a href="Component.html">Component</a></li><li><a href="Trait.html">Trait</a></li></ul><h3>Classes</h3><ul class=classes><li><a href="Api.html">Api</a><ul class='methods'><li data-type='method'><a href="Api.html#call">call</a></li><li data-type='method'><a href="Api.html#getConfigValue">getConfigValue</a></li><li data-type='method'><a href="Api.html#getPluginModule">getPluginModule</a></li><li data-type='method'><a href="Api.html#getPluginModulesForTarget">getPluginModulesForTarget</a></li><li data-type='method'><a href="Api.html#hasLocalConfiguration">hasLocalConfiguration</a></li><li data-type='method'><a href="Api.html#init">init</a></li></ul></li><li><a href="Api.Article.html"><span class="member-of">Api.</span>Article</a><ul class='methods'><li data-type='method'><a href="Api.Article.html#clear">clear</a></li><li data-type='method'><a href="Api.Article.html#copy">copy</a></li></ul></li><li><a href="Api.Browser.html"><span class="member-of">Api.</span>Browser</a><ul class='methods'><li data-type='method'><a href="Api.Browser.html#addExternalScript">addExternalScript</a></li><li data-type='method'><a href="Api.Browser.html#getHash">getHash</a></li><li data-type='method'><a href="Api.Browser.html#getUrl">getUrl</a></li><li data-type='method'><a href="Api.Browser.html#isSupported">isSupported</a></li><li data-type='method'><a href="Api.Browser.html#openInNewWindow">openInNewWindow</a></li><li data-type='method'><a href="Api.Browser.html#reload">reload</a></li><li data-type='method'><a href="Api.Browser.html#setHash">setHash</a></li><li data-type='method'><a href="Api.Browser.html#setTitle">setTitle</a></li><li data-type='method'><a href="Api.Browser.html#setupHashHandler">setupHashHandler</a></li></ul></li><li><a href="Api.Concept.html"><span class="member-of">Api.</span>Concept</a><ul class='methods'><li data-type='method'><a href="Api.Concept.html#.getDefinitionForType">getDefinitionForType</a></li><li data-type='method'><a href="Api.Concept.html#.setDefinitionDependingOnArrayOrObject">setDefinitionDependingOnArrayOrObject</a></li></ul></li><li><a href="Api.Document.html"><span class="member-of">Api.</span>Document</a><ul class='methods'><li data-type='method'><a href="Api.Document.html#deleteNode">deleteNode</a></li><li data-type='method'><a href="Api.Document.html#getDocumentNodes">getDocumentNodes</a></li><li data-type='method'><a href="Api.Document.html#getPreviousNode">getPreviousNode</a></li><li data-type='method'><a href="Api.Document.html#insertBlockNode">insertBlockNode</a></li><li data-type='method'><a href="Api.Document.html#insertInlineNode">insertInlineNode</a></li><li data-type='method'><a href="Api.Document.html#triggerFetchResourceNode">triggerFetchResourceNode</a></li></ul></li><li><a href="Api.Events.html"><span class="member-of">Api.</span>Events</a><ul class='methods'><li data-type='method'><a href="Api.Events.html#_triggerEvent">_triggerEvent</a></li><li data-type='method'><a href="Api.Events.html#documentChanged">documentChanged</a></li><li data-type='method'><a href="Api.Events.html#documentSaved">documentSaved</a></li><li data-type='method'><a href="Api.Events.html#documentSaveFailed">documentSaveFailed</a></li><li data-type='method'><a href="Api.Events.html#off">off</a></li><li data-type='method'><a href="Api.Events.html#on">on</a></li><li data-type='method'><a href="Api.Events.html#onDocumentStartSaving">onDocumentStartSaving</a></li></ul></li><li><a href="Api.History.html"><span class="member-of">Api.</span>History</a><ul class='methods'><li data-type='method'><a href="Api.History.html#cleanOldVersions">cleanOldVersions</a></li><li data-type='method'><a href="Api.History.html#cleanVersionsOlderThanMaxDays">cleanVersionsOlderThanMaxDays</a></li><li data-type='method'><a href="Api.History.html#deleteHistory">deleteHistory</a></li><li data-type='method'><a href="Api.History.html#get">get</a></li><li data-type='method'><a href="Api.History.html#getHistory">getHistory</a></li><li data-type='method'><a href="Api.History.html#isAvailable">isAvailable</a></li><li data-type='method'><a href="Api.History.html#saveHistory">saveHistory</a></li></ul></li><li><a href="Api.NewsItem.html"><span class="member-of">Api.</span>NewsItem</a><ul class='methods'><li data-type='method'><a href="Api.NewsItem.html#addAuthor">addAuthor</a></li><li data-type='method'><a href="Api.NewsItem.html#addCategory">addCategory</a></li><li data-type='method'><a href="Api.NewsItem.html#addChannel">addChannel</a></li><li data-type='method'><a href="Api.NewsItem.html#addConceptProfile">addConceptProfile</a></li><li data-type='method'><a href="Api.NewsItem.html#addContentMetaLink">addContentMetaLink</a></li><li data-type='method'><a href="Api.NewsItem.html#addContentProfile">addContentProfile</a></li><li data-type='method'><a href="Api.NewsItem.html#addLink">addLink</a></li><li data-type='method'><a href="Api.NewsItem.html#addLocation">addLocation</a></li><li data-type='method'><a href="Api.NewsItem.html#addSimpleAuthor">addSimpleAuthor</a></li><li data-type='method'><a href="Api.NewsItem.html#addStory">addStory</a></li><li data-type='method'><a href="Api.NewsItem.html#addTag">addTag</a></li><li data-type='method'><a href="Api.NewsItem.html#createExtendedGeoLink">createExtendedGeoLink</a></li><li data-type='method'><a href="Api.NewsItem.html#createNewsPriority">createNewsPriority</a></li><li data-type='method'><a href="Api.NewsItem.html#getAuthors">getAuthors</a></li><li data-type='method'><a href="Api.NewsItem.html#getCategories">getCategories</a></li><li data-type='method'><a href="Api.NewsItem.html#getChannels">getChannels</a></li><li data-type='method'><a href="Api.NewsItem.html#getContentCreated">getContentCreated</a></li><li data-type='method'><a href="Api.NewsItem.html#getContentMetaLinkByType">getContentMetaLinkByType</a></li><li data-type='method'><a href="Api.NewsItem.html#getContentMetaObjectById">getContentMetaObjectById</a></li><li data-type='method'><a href="Api.NewsItem.html#getContentMetaObjectsByType">getContentMetaObjectsByType</a></li><li data-type='method'><a href="Api.NewsItem.html#getContentModified">getContentModified</a></li><li data-type='method'><a href="Api.NewsItem.html#getContentProfiles">getContentProfiles</a></li><li data-type='method'><a href="Api.NewsItem.html#getEdNote">getEdNote</a></li><li data-type='method'><a href="Api.NewsItem.html#getFirstCreated">getFirstCreated</a></li><li data-type='method'><a href="Api.NewsItem.html#getGuid">getGuid</a></li><li data-type='method'><a href="Api.NewsItem.html#getHasPublishedVersion">getHasPublishedVersion</a></li><li data-type='method'><a href="Api.NewsItem.html#getIdForArticle">getIdForArticle</a></li><li data-type='method'><a href="Api.NewsItem.html#getLinkByType">getLinkByType</a></li><li data-type='method'><a href="Api.NewsItem.html#getLinkByTypeAndRel">getLinkByTypeAndRel</a></li><li data-type='method'><a href="Api.NewsItem.html#getLinksByType">getLinksByType</a></li><li data-type='method'><a href="Api.NewsItem.html#getLocations">getLocations</a></li><li data-type='method'><a href="Api.NewsItem.html#getMainChannel">getMainChannel</a></li><li data-type='method'><a href="Api.NewsItem.html#getNewspilotArticleId">getNewspilotArticleId</a></li><li data-type='method'><a href="Api.NewsItem.html#getNewsPriority">getNewsPriority</a></li><li data-type='method'><a href="Api.NewsItem.html#getPubStart">getPubStart</a></li><li data-type='method'><a href="Api.NewsItem.html#getPubStatus">getPubStatus</a></li><li data-type='method'><a href="Api.NewsItem.html#getPubStop">getPubStop</a></li><li data-type='method'><a href="Api.NewsItem.html#getSection">getSection</a></li><li data-type='method'><a href="Api.NewsItem.html#getSections">getSections</a></li><li data-type='method'><a href="Api.NewsItem.html#getStories">getStories</a></li><li data-type='method'><a href="Api.NewsItem.html#getTags">getTags</a></li><li data-type='method'><a href="Api.NewsItem.html#getTemporaryId">getTemporaryId</a></li><li data-type='method'><a href="Api.NewsItem.html#getVersionCreated">getVersionCreated</a></li><li data-type='method'><a href="Api.NewsItem.html#hasTemporaryId">hasTemporaryId</a></li><li data-type='method'><a href="Api.NewsItem.html#invalidate">invalidate</a></li><li data-type='method'><a href="Api.NewsItem.html#removeAuthorByTitle">removeAuthorByTitle</a></li><li data-type='method'><a href="Api.NewsItem.html#removeAuthorByUUID">removeAuthorByUUID</a></li><li data-type='method'><a href="Api.NewsItem.html#removeChannel">removeChannel</a></li><li data-type='method'><a href="Api.NewsItem.html#removeContentMetaObject">removeContentMetaObject</a></li><li data-type='method'><a href="Api.NewsItem.html#removeLinkByUUID">removeLinkByUUID</a></li><li data-type='method'><a href="Api.NewsItem.html#removeLinkByUUIDAndRel">removeLinkByUUIDAndRel</a></li><li data-type='method'><a href="Api.NewsItem.html#removeLinkContentMetaByTypeAndMatchingFilter">removeLinkContentMetaByTypeAndMatchingFilter</a></li><li data-type='method'><a href="Api.NewsItem.html#removeLinkContentMetaByTypeAndRel">removeLinkContentMetaByTypeAndRel</a></li><li data-type='method'><a href="Api.NewsItem.html#removePubStart">removePubStart</a></li><li data-type='method'><a href="Api.NewsItem.html#removePubStop">removePubStop</a></li><li data-type='method'><a href="Api.NewsItem.html#removeSection">removeSection</a></li><li data-type='method'><a href="Api.NewsItem.html#save">save</a></li><li data-type='method'><a href="Api.NewsItem.html#setContentMetaObject">setContentMetaObject</a></li><li data-type='method'><a href="Api.NewsItem.html#setEdNote">setEdNote</a></li><li data-type='method'><a href="Api.NewsItem.html#setGuid">setGuid</a></li><li data-type='method'><a href="Api.NewsItem.html#setHasPublishedVersion">setHasPublishedVersion</a></li><li data-type='method'><a href="Api.NewsItem.html#setNewsPriority">setNewsPriority</a></li><li data-type='method'><a href="Api.NewsItem.html#setPubStart">setPubStart</a></li><li data-type='method'><a href="Api.NewsItem.html#setPubStatus">setPubStatus</a></li><li data-type='method'><a href="Api.NewsItem.html#setPubStop">setPubStop</a></li><li data-type='method'><a href="Api.NewsItem.html#setSource">setSource</a></li><li data-type='method'><a href="Api.NewsItem.html#setTemporaryId">setTemporaryId</a></li><li data-type='method'><a href="Api.NewsItem.html#updateAuthorWithUUID">updateAuthorWithUUID</a></li><li data-type='method'><a href="Api.NewsItem.html#updateBroaderLinks">updateBroaderLinks</a></li><li data-type='method'><a href="Api.NewsItem.html#updateConcept">updateConcept</a></li><li data-type='method'><a href="Api.NewsItem.html#updateConceptData">updateConceptData</a></li><li data-type='method'><a href="Api.NewsItem.html#updateConceptProfile">updateConceptProfile</a></li><li data-type='method'><a href="Api.NewsItem.html#updateContentProfile">updateContentProfile</a></li><li data-type='method'><a href="Api.NewsItem.html#updateLocation">updateLocation</a></li><li data-type='method'><a href="Api.NewsItem.html#updateSection">updateSection</a></li><li data-type='method'><a href="Api.NewsItem.html#updateStory">updateStory</a></li><li data-type='method'><a href="Api.NewsItem.html#updateTag">updateTag</a></li></ul></li><li><a href="Api.Router.html"><span class="member-of">Api.</span>Router</a><ul class='methods'><li data-type='method'><a href="Api.Router.html#checkForOKStatus">checkForOKStatus</a></li><li data-type='method'><a href="Api.Router.html#createConceptItem">createConceptItem</a></li><li data-type='method'><a href="Api.Router.html#get">get</a></li><li data-type='method'><a href="Api.Router.html#getConceptItem">getConceptItem</a></li><li data-type='method'><a href="Api.Router.html#getEndpoint">getEndpoint</a></li><li data-type='method'><a href="Api.Router.html#getNewsItem">getNewsItem</a></li><li data-type='method'><a href="Api.Router.html#getQuerystringFromParameters">getQuerystringFromParameters</a></li><li data-type='method'><a href="Api.Router.html#getRequestPropertiesForMethod">getRequestPropertiesForMethod</a></li><li data-type='method'><a href="Api.Router.html#post">post</a></li><li data-type='method'><a href="Api.Router.html#postBinary">postBinary</a></li><li data-type='method'><a href="Api.Router.html#proxy">proxy</a></li><li data-type='method'><a href="Api.Router.html#put">put</a></li><li data-type='method'><a href="Api.Router.html#toJson">toJson</a></li><li data-type='method'><a href="Api.Router.html#updateConceptItem">updateConceptItem</a></li></ul></li><li><a href="Api.Settings.html"><span class="member-of">Api.</span>Settings</a><ul class='methods'><li data-type='method'><a href="Api.Settings.html#delete">delete</a></li><li data-type='method'><a href="Api.Settings.html#get">get</a></li><li data-type='method'><a href="Api.Settings.html#getAllSettings">getAllSettings</a></li><li data-type='method'><a href="Api.Settings.html#isAvailable">isAvailable</a></li><li data-type='method'><a href="Api.Settings.html#set">set</a></li></ul></li><li><a href="Api.Ui.html"><span class="member-of">Api.</span>Ui</a><ul class='methods'><li data-type='method'><a href="Api.Ui.html#getComponent">getComponent</a></li><li data-type='method'><a href="Api.Ui.html#showDialog">showDialog</a></li><li data-type='method'><a href="Api.Ui.html#showMessageDialog">showMessageDialog</a></li><li data-type='method'><a href="Api.Ui.html#showNotification">showNotification</a></li></ul></li><li><a href="Api.Upload.html"><span class="member-of">Api.</span>Upload</a><ul class='methods'><li data-type='method'><a href="Api.Upload.html#uploadFile">uploadFile</a></li></ul></li><li><a href="Component.AvatarComponent.html"><span class="member-of">Component.</span>AvatarComponent</a><ul class='methods'><li data-type='method'><a href="Component.AvatarComponent.html#loadAvatarUrlForAvatarId">loadAvatarUrlForAvatarId</a></li></ul></li><li><a href="Component.ButtonComponent.html"><span class="member-of">Component.</span>ButtonComponent</a></li><li><a href="Component.BylineComponent.html"><span class="member-of">Component.</span>BylineComponent</a></li><li><a href="Component.DatetimeFieldEditorComponent.html"><span class="member-of">Component.</span>DatetimeFieldEditorComponent</a></li><li><a href="Component.DialogComponent.html"><span class="member-of">Component.</span>DialogComponent</a><ul class='methods'><li data-type='method'><a href="Component.DialogComponent.html#changeModalHeight">changeModalHeight</a></li></ul></li><li><a href="Component.DialogImageComponent.html"><span class="member-of">Component.</span>DialogImageComponent</a><ul class='methods'><li data-type='method'><a href="Component.DialogImageComponent.html#renderAuthor">renderAuthor</a></li><li data-type='method'><a href="Component.DialogImageComponent.html#saveImageData">saveImageData</a></li><li data-type='method'><a href="Component.DialogImageComponent.html#syncPhotoDate">syncPhotoDate</a></li></ul></li><li><a href="Component.DropdownComponent.html"><span class="member-of">Component.</span>DropdownComponent</a></li><li><a href="Component.FieldEditorComponent.html"><span class="member-of">Component.</span>FieldEditorComponent</a></li><li><a href="Component.FormAddComponent.html"><span class="member-of">Component.</span>FormAddComponent</a></li><li><a href="Component.FormSearchComponent.html"><span class="member-of">Component.</span>FormSearchComponent</a></li><li><a href="Component.ImageCropperComponent.html"><span class="member-of">Component.</span>ImageCropperComponent</a></li><li><a href="Component.InlineImageComponent.html"><span class="member-of">Component.</span>InlineImageComponent</a></li><li><a href="Component.Notification.html"><span class="member-of">Component.</span>Notification</a></li><li><a href="Component.NotificationListComponent.html"><span class="member-of">Component.</span>NotificationListComponent</a></li><li><a href="Component.PlaceholderComponent.html"><span class="member-of">Component.</span>PlaceholderComponent</a></li><li><a href="Component.SelectComponent.html"><span class="member-of">Component.</span>SelectComponent</a><ul class='methods'><li data-type='method'><a href="Component.SelectComponent.html#renderButtonList">renderButtonList</a></li><li data-type='method'><a href="Component.SelectComponent.html#renderDropDownList">renderDropDownList</a></li><li data-type='method'><a href="Component.SelectComponent.html#renderList">renderList</a></li><li data-type='method'><a href="Component.SelectComponent.html#renderToggleList">renderToggleList</a></li></ul></li><li><a href="Component.ToggleComponent.html"><span class="member-of">Component.</span>ToggleComponent</a></li><li><a href="Component.TooltipComponent.html"><span class="member-of">Component.</span>TooltipComponent</a><ul class='methods'><li data-type='method'><a href="Component.TooltipComponent.html#hide">hide</a></li></ul></li><li><a href="ConceptService.html">ConceptService</a><ul class='methods'><li data-type='method'><a href="ConceptService.html#_search">_search</a></li><li data-type='method'><a href="ConceptService.html#addArticleConcept">addArticleConcept</a></li><li data-type='method'><a href="ConceptService.html#addExtendedGeo">addExtendedGeo</a></li><li data-type='method'><a href="ConceptService.html#createConceptItemXml">createConceptItemXml</a></li><li data-type='method'><a href="ConceptService.html#extractBroaderText">extractBroaderText</a></li><li data-type='method'><a href="ConceptService.html#fetchConceptItemConfigJson">fetchConceptItemConfigJson</a></li><li data-type='method'><a href="ConceptService.html#fetchConceptItemProperties">fetchConceptItemProperties</a></li><li data-type='method'><a href="ConceptService.html#fetchConceptItemTemplateXml">fetchConceptItemTemplateXml</a></li><li data-type='method'><a href="ConceptService.html#getArticleConceptsByType">getArticleConceptsByType</a></li><li data-type='method'><a href="ConceptService.html#getConceptItemXml">getConceptItemXml</a></li><li data-type='method'><a href="ConceptService.html#getPropertyMap">getPropertyMap</a></li><li data-type='method'><a href="ConceptService.html#removeArticleConceptItem">removeArticleConceptItem</a></li><li data-type='method'><a href="ConceptService.html#searchForConceptSuggestions">searchForConceptSuggestions</a></li><li data-type='method'><a href="ConceptService.html#updateArticleConcept">updateArticleConcept</a></li><li data-type='method'><a href="ConceptService.html#updateConceptItemXml">updateConceptItemXml</a></li></ul></li><li><a href="ConfigEditorComponent.html">ConfigEditorComponent</a></li><li><a href="KBDKeyComboComponent.html">KBDKeyComboComponent</a></li><li><a href="KeybindingCaptureComponent.html">KeybindingCaptureComponent</a></li><li><a href="KeybindingEditorComponent.html">KeybindingEditorComponent</a><ul class='methods'><li data-type='method'><a href="KeybindingEditorComponent.html#_onCapturedKeybindingCancel">_onCapturedKeybindingCancel</a></li><li data-type='method'><a href="KeybindingEditorComponent.html#_onCapturedKeybindingSave">_onCapturedKeybindingSave</a></li><li data-type='method'><a href="KeybindingEditorComponent.html#_renderKeybindingRow">_renderKeybindingRow</a></li><li data-type='method'><a href="KeybindingEditorComponent.html#_renderTableHeader">_renderTableHeader</a></li><li data-type='method'><a href="KeybindingEditorComponent.html#getInitialState">getInitialState</a></li><li data-type='method'><a href="KeybindingEditorComponent.html#getKeybindings">getKeybindings</a></li><li data-type='method'><a href="KeybindingEditorComponent.html#onClose">onClose</a></li></ul></li><li><a href="NewsMLArticle.html">NewsMLArticle</a></li><li><a href="NewsMLImporter.html">NewsMLImporter</a><ul class='methods'><li data-type='method'><a href="NewsMLImporter.html#getFirstElementWithTypeElement">getFirstElementWithTypeElement</a></li></ul></li><li><a href="NotFoundException.html">NotFoundException</a></li><li><a href="NPWriterConfigurator.html">NPWriterConfigurator</a><ul class='methods'><li data-type='method'><a href="NPWriterConfigurator.html#addContentMenuTool">addContentMenuTool</a></li><li data-type='method'><a href="NPWriterConfigurator.html#addFileProxy">addFileProxy</a></li><li data-type='method'><a href="NPWriterConfigurator.html#addHook">addHook</a></li><li data-type='method'><a href="NPWriterConfigurator.html#addKeyboardShortcut">addKeyboardShortcut</a></li><li data-type='method'><a href="NPWriterConfigurator.html#addOverlayTool">addOverlayTool</a></li><li data-type='method'><a href="NPWriterConfigurator.html#addPluginModule">addPluginModule</a></li><li data-type='method'><a href="NPWriterConfigurator.html#addPopover">addPopover</a></li><li data-type='method'><a href="NPWriterConfigurator.html#addTextEditComponent">addTextEditComponent</a></li><li data-type='method'><a href="NPWriterConfigurator.html#addTopBarComponent">addTopBarComponent</a></li><li data-type='method'><a href="NPWriterConfigurator.html#addToSidebar">addToSidebar</a></li><li data-type='method'><a href="NPWriterConfigurator.html#addValidator">addValidator</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getHooks">getHooks</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getLabelProvider">getLabelProvider</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getLocale">getLocale</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getNewsItemTemplateId">getNewsItemTemplateId</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getOrderedSideBars">getOrderedSideBars</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getPluginModule">getPluginModule</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getPluginModulesForTarget">getPluginModulesForTarget</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getSidebarPanels">getSidebarPanels</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getSideBars">getSideBars</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getValidators">getValidators</a></li><li data-type='method'><a href="NPWriterConfigurator.html#getWriterConfiguration">getWriterConfiguration</a></li><li data-type='method'><a href="NPWriterConfigurator.html#loadWriterConfiguration">loadWriterConfiguration</a></li><li data-type='method'><a href="NPWriterConfigurator.html#registerConflictHandler">registerConflictHandler</a></li><li data-type='method'><a href="NPWriterConfigurator.html#setWriterConfiguration">setWriterConfiguration</a></li></ul></li><li><a href="OEmbedExporter.html">OEmbedExporter</a><ul class='methods'><li data-type='method'><a href="OEmbedExporter.html#getContext">getContext</a></li><li data-type='method'><a href="OEmbedExporter.html#getTitle">getTitle</a></li></ul></li><li><a href="PaginationComponent.html">PaginationComponent</a></li><li><a href="PluginManager.html">PluginManager</a><ul class='methods'><li data-type='method'><a href="PluginManager.html#_getValue">_getValue</a></li><li data-type='method'><a href="PluginManager.html#appendPluginScripts">appendPluginScripts</a></li><li data-type='method'><a href="PluginManager.html#getListOfPlugins">getListOfPlugins</a></li><li data-type='method'><a href="PluginManager.html#load">load</a></li><li data-type='method'><a href="PluginManager.html#registerPlugin">registerPlugin</a></li><li data-type='method'><a href="PluginManager.html#validatePluginPackage">validatePluginPackage</a></li></ul></li><li><a href="Validator.html">Validator</a><ul class='methods'><li data-type='method'><a href="Validator.html#addError">addError</a></li><li data-type='method'><a href="Validator.html#addInfo">addInfo</a></li><li data-type='method'><a href="Validator.html#addWarning">addWarning</a></li><li data-type='method'><a href="Validator.html#getMessages">getMessages</a></li><li data-type='method'><a href="Validator.html#hasMessages">hasMessages</a></li></ul></li></ul><h3>Externals</h3><ul class=externals><li><a href="external-Substance.html">Substance</a></li></ul><h3>Mixins</h3><ul class=mixins><li><a href="Trait.authorNodeTrait.html"><span class="member-of">Trait.</span>authorNodeTrait</a><ul class='methods'><li data-type='method'><a href="Trait.authorNodeTrait.html#.addAuthor">addAuthor</a></li><li data-type='method'><a href="Trait.authorNodeTrait.html#.fetchAuthorConcept">fetchAuthorConcept</a></li><li data-type='method'><a href="Trait.authorNodeTrait.html#.fetchAuthorsConcept">fetchAuthorsConcept</a></li><li data-type='method'><a href="Trait.authorNodeTrait.html#.removeAuthor">removeAuthor</a></li><li data-type='method'><a href="Trait.authorNodeTrait.html#.setAuthors">setAuthors</a></li><li data-type='method'><a href="Trait.authorNodeTrait.html#.updateAuthorFromConcept">updateAuthorFromConcept</a></li></ul></li><li><a href="Trait.imageCropTrait.html"><span class="member-of">Trait.</span>imageCropTrait</a><ul class='methods'><li data-type='method'><a href="Trait.imageCropTrait.html#.setSoftcropData">setSoftcropData</a></li></ul></li><li><a href="Trait.imageNodeTrait.html"><span class="member-of">Trait.</span>imageNodeTrait</a><ul class='methods'><li data-type='method'><a href="Trait.imageNodeTrait.html#.fetchSpecifiedUrls">fetchSpecifiedUrls</a></li><li data-type='method'><a href="Trait.imageNodeTrait.html#.getImageFile">getImageFile</a></li><li data-type='method'><a href="Trait.imageNodeTrait.html#.getUrl">getUrl</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#exportSoftcropLinks">exportSoftcropLinks</a></li><li><a href="global.html#importSoftcropLinks">importSoftcropLinks</a></li></ul>
</nav>

<div id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {
    OpenContentClient,
    QueryBuilder,
    QueryResponseHelper
} from '@infomaker/oc-client'
import {isObject} from 'lodash'

/**
 * ConceptService class
 *
 * A service filled with utility functions for Concept items
 * and enhanced data loading
 *
 */
class ConceptService {

    /**
     * Constructor
     *
     * @param {object} api Writer API instance
     * @param {object} config Config object from writer.json
     */
    constructor(api, config) {
        this.api = api
        this.contenttype = 'Concept'
        this.client = (config &amp;&amp; config.baProxy) ? new OpenContentClient(config.baProxy) : null
        this.broaderLimit = (config &amp;&amp; config.broaderLimit) ? config.broaderLimit : 3
        this.searchLimit = (config &amp;&amp; config.searchLimit) ? config.searchLimit : 25
        this.sortField = (config &amp;&amp; config.sortField) ? config.sortField : 'ConceptNameString'
        this.propertyMap = Object.assign({
            "ConceptName": "ConceptName",
            "ConceptStatus": "ConceptStatus",
            "ConceptDefinitionShort": "ConceptDefinitionShort",
            "ConceptDefinitionLong": "ConceptDefinitionLong",
            "ConceptImTypeFull": "ConceptImTypeFull",
            "ConceptImSubTypeFull": "ConceptImSubTypeFull",
            "ConceptGeometry": "ConceptGeometry",
            "ConceptBroaderRelation": "ConceptBroaderRelation",
            "ConceptReplacedByRelation": "ConceptReplacedByRelation"
        }, (config &amp;&amp; config.propertyMap) ? config.propertyMap : {})

        this.responseProperties = Object.keys(this.propertyMap)
        this.responseProperties.splice(this.responseProperties.indexOf(this.propertyMap.ConceptBroaderRelation), 1)
        this.responseProperties.splice(this.responseProperties.indexOf(this.propertyMap.ConceptReplacedByRelation), 1)

        this.responseProperties.concat().forEach(prop => {
            if (prop !== this.propertyMap.ConceptBroaderRelation &amp;&amp; prop !== this.propertyMap.ConceptReplacedByRelation) {
                this.responseProperties.push(`${this.propertyMap.ConceptReplacedByRelation}.${prop}`)
            }
        })

        let parent = this.propertyMap.ConceptBroaderRelation
        for (let index = 0; index &lt; this.broaderLimit; index++) {
            this.responseProperties.push(`${parent}.uuid`)
            this.responseProperties.push(`${parent}.${this.propertyMap.ConceptName}`)
            this.responseProperties.push(`${parent}.${this.propertyMap.ConceptImTypeFull}`)
            parent = `${parent}.${this.propertyMap.ConceptBroaderRelation}`
        }

        if (config) {
            if (config.conceptPath &amp;&amp; config.conceptPath.slice(-1) === '/') {
                config.conceptPath = config.conceptPath.substr(0, config.conceptPath.length - 1)
            }

            this.config = config
            this.contenttype = config.contenttype || this.contenttype

            Promise.resolve(this._fetchCommonConfigurationFile()).then(commonConfig => {
                this.commonConfig = commonConfig
            })
        } else {
            console.warn('Missing concept service configuration')
        }
    }

    /**
     * Get loaded property map
     *
     * @returns {object} PropertyMap
     */
    getPropertyMap() {
        return this.propertyMap
    }

    /**
     * Get remote config filename for a perticular concept type
     *
     * @private
     * @param {object} conceptItem POJSO representation of a x-im concept
     *
     * @returns {string} fileName
     */
    _getConceptFileName(conceptItem) {
        const type = (conceptItem.type || conceptItem[this.propertyMap.ConceptImTypeFull]).replace('x-im/', '')
        const subType = (type === 'place') ? conceptItem[this.propertyMap.ConceptImSubTypeFull] ? `-${conceptItem[this.propertyMap.ConceptImSubTypeFull].replace('x-im/', '')}` : '-position' : ''
        let fileName = `${type}${subType}`
        if (fileName.slice(-1) === '-') {
            fileName = fileName.substr(0, fileName.length - 1)
        }

        return fileName
    }

    /**
     * Get value for article concept link rel attribute based on concept type
     *
     * @private
     * @param {string} conceptType 'x-im/xxx'
     *
     * @returns {string} rel
     */
    _getConceptRel(conceptType) {
        switch (conceptType.toLowerCase()) {
            case 'x-im/channel':
                return 'channel'

            case 'x-im/author':
                return 'author'

            default:
                return 'subject'
        }
    }

    /**
     * Get the current article concepts
     *
     * @param {string} conceptType 'x-im/xxx'
     * @param {array} multipleTypes ex. ['x-im/xxx', 'x-im/yyy']
     * @param {array} subtypes ex. ['position', 'polygon']
     *
     * @returns {array} ConceptItems
     */
    getArticleConceptsByType(conceptType, multipleTypes, subtypes) {
        let places = []
        switch (conceptType.toLowerCase()) {

            case 'x-im/tag':
                if (Array.isArray(multipleTypes)) {
                    return this.api.newsItem.getTags(multipleTypes)
                } else {
                    return this.api.newsItem.getTags([conceptType])
                }

            case 'x-im/topic':
            case 'x-im/person':
            case 'x-im/event':
            case 'x-im/organisation':
            case 'x-im/content-profile':
                return this.api.newsItem.getTags([conceptType])

            case 'x-im/author':
                return this.api.newsItem.getAuthors()

            case 'x-im/story':
                return this.api.newsItem.getStories()

            case 'x-im/category':
                return this.api.newsItem.getCategories()

            case 'x-im/channel':
                return this.api.newsItem.getNormalizedChannels()

            case 'x-im/place':
                if (Array.isArray(subtypes)) {
                    subtypes.forEach(type => {
                        places = [...places, ...this.api.newsItem.getLocations(type)]
                    })
                } else {
                    places = this.api.newsItem.getLocations('all')
                }
                return places

            default:
                return []
        }
    }

    /**
     * Add concept link to article
     *
     * @param {object} conceptItem POJSO representation of a x-im concept
     */
    addArticleConcept(conceptItem) {
        const name = conceptItem.type.replace('-', '').replace('/', '')
        this.api.newsItem.addLink(name, {
            '@rel': this._getConceptRel(conceptItem.ConceptImTypeFull),
            '@title': conceptItem.ConceptName,
            '@type': conceptItem.ConceptImTypeFull,
            '@uuid': conceptItem.uuid
        })

        this.api.newsItem.updateConcept(name, conceptItem, this.propertyMap)

        if (name === 'ximplace') {
            this.addExtendedGeo()
        }
    }

    /**
     * Update existing concept link in article
     *
     * @param {object} conceptItem POJSO representation of a x-im concept
     */
    updateArticleConcept(conceptItem) {
        const name = conceptItem.type.replace('-', '').replace('/', '')
        this.api.newsItem.updateConcept(name, conceptItem, this.propertyMap)

        if (name === 'ximplace') {
            this.addExtendedGeo()
        }
    }

    /**
     * Remove concept link from article
     *
     * @param {object} conceptItem POJSO representation of a x-im concept
     */
    removeArticleConceptItem(conceptItem) {
        const name = conceptItem.type.replace('-', '').replace('/', '')
        this.api.newsItem.removeLinkByUUIDAndRel(name, conceptItem.uuid, conceptItem.rel)

        if (name === 'ximplace') {
            this.addExtendedGeo()
        }
    }

    /**
     * Add info about related Geozones in the article meta
     *
     * This will grab all polygon-links in article and combine into one OC query
     * that will get all polygons matching the configured function (Contains/Intersects/IsWithin)
     *
     */
    async addExtendedGeo() {
        if (this.config.relatedGeoFunction) {
            const existingLinks = this.getArticleConceptsByType('x-im/place', ['all'])
            let query = {type: `${this.propertyMap.ConceptImTypeFull}:x-im/place`}
            let convertedHits = []

            existingLinks.filter(link => link.data &amp;&amp; link.data.geometry).reduce((iterator, link) => {
                iterator.not = `${iterator.not ? iterator.not : ''}${iterator.not ? ' AND' : ''} NOT uuid:${link.uuid}`
                iterator.geo = `${iterator.geo ? iterator.geo : ''}${iterator.geo ? ' OR' : ''} ${this.propertyMap.ConceptGeometry}:"${this.config.relatedGeoFunction}(${link.data.geometry})"`

                return iterator
            }, query)

            const queryBuilder = new QueryBuilder({
                q: this.config.relatedGeoExludeSelf ?
                    `${query.type} AND ${query.not} AND (${query.geo})` :
                    `${query.type} AND (${query.geo})`,
                contenttype: this.contenttype
            })
                .setStart(0)
                .setLimit(25)
                .setResponseProperties(this.responseProperties)

            const builtQuery = queryBuilder.build()
            const items = await this.fetchItems(builtQuery)

            if (items &amp;&amp; items.length) {
                items.forEach(item => convertedHits.push(this._convertProps(item.versions[0].properties)))
            }

            this.api.newsItem.createExtendedGeoLink(convertedHits)
        }
    }

    /**
     * Recursive function to extract n number of parent names
     *
     * @param {object} conceptItem POJSO representation of a x-im concept
     * @param {boolean} [truncated=false]
     *
     * @returns {string} Broader names combine
     */
    extractBroaderText(conceptItem, truncated = false) {
        let broader = ''

        if (conceptItem[this.propertyMap.ConceptBroaderRelation] &amp;&amp; conceptItem[this.propertyMap.ConceptBroaderRelation][this.propertyMap.ConceptName]) {
            broader = conceptItem[this.propertyMap.ConceptBroaderRelation][this.propertyMap.ConceptName]

            if (conceptItem[this.propertyMap.ConceptBroaderRelation][this.propertyMap.ConceptBroaderRelation]) {
                if (truncated) {
                    broader = `.../${broader}`
                } else {
                    broader = `${this.extractBroaderText(conceptItem[this.propertyMap.ConceptBroaderRelation])}/${broader}`
                }
            }
        }

        return broader
    }

    /**
     * Recursive function to map OC array props to POJSO
     * Will follow hierarchy props recursivly
     *
     * @private
     *
     * @param {object} props
     */
    _convertProps(props) {
        return Object.keys(props).reduce((obj, key) => {
            obj[key] = (props[key] &amp;&amp; props[key][0]) ? isObject(props[key][0]) ? this._convertProps(props[key][0]) : props[key][0] : ''
            return obj
        }, {})
    }

    /**
     * Search baproxy with a pre-built query
     *
     * @private
     * @param {object} builtQuery
     *
     * @returns {array} OC Response
     */
    async fetchItems(builtQuery) {
        let items = []

        if (this.client) {
            try {
                const rawResult = await this.client.search(builtQuery)
                const jsonResult = await rawResult.json()
                items = new QueryResponseHelper(jsonResult).getItems()
            } catch (error) {
                console.warn('ConceptService: unable to fetch items')
                console.warn(error)
            }
        }

        return items
    }

    /**
     * Get the actual concept XML from storage
     *
     * @param {object} conceptItem POJSO representation of a x-im concept
     *
     * @returns {string} XML response
     */
    async getConceptItemXml(conceptItem) {
        if (conceptItem.uuid) {
            return await this.api.router.getConceptItem(conceptItem.uuid, conceptItem[this.propertyMap.ConceptImTypeFull] || conceptItem.type)
        } else {
            return await this.fetchConceptItemTemplateXml(conceptItem)
        }
    }

    /**
     * Create a new concept item in storage
     *
     * @param {string} xml
     */
    async createConceptItemXml(xml) {
        return await this.api.router.createConceptItem(xml)
    }

    /**
     * Update the actual concept XML in storage
     *
     * @param {string} uuid
     * @param {string} xml
     */
    async updateConceptItemXml(uuid, xml) {
        return await this.api.router.updateConceptItem(uuid, xml)
    }

    /**
     * Load remote common config file
     *
     * @private
     *
     * @returns {object} json
     */
    async _fetchCommonConfigurationFile() {
        const response = await fetch(`${this.config.conceptPath}/common.json`)

        if (response.ok) {
            return await response.json()
        } else {
            return {}
        }
    }

    /**
     * Fetch remote XML template
     *
     * @param {object} conceptItem POJSO representation of a x-im concept
     *
     * @returns {string} XML Response
     */
    async fetchConceptItemTemplateXml(conceptItem) {
        let response

        if (conceptItem[this.propertyMap.ConceptImTypeFull]) {
            let fileName = this._getConceptFileName(conceptItem)
            response = await fetch(`${this.config.conceptPath}/${fileName}.xml`)

            if (response.ok) {
                const rawText = await response.text()
                return await (new window.DOMParser()).parseFromString(rawText, 'text/xml')
            }
        }

        throw new Error(`Unable to load concept template, ${(response &amp;&amp; response.statusText) ? response.statusText : 'unknown error'}`)
    }

    /**
     * Fetch remote concept config
     *
     * @param {object} conceptItem POJSO representation of a x-im concept
     *
     * @returns {string} JSON Response
     */
    async fetchConceptItemConfigJson(conceptItem) {
        let response

        if (conceptItem.type || conceptItem[this.propertyMap.ConceptImTypeFull]) {
            let fileName = this._getConceptFileName(conceptItem)
            response = await fetch(`${this.config.conceptPath}/${fileName}.json`)
            if (response.ok) {
                const json = await response.json()
                json.common = this.commonConfig
                return json
            }
        }

        throw new Error(`Unable to load concept service configuration, ${(response &amp;&amp; response.statusText) ? response.statusText : 'unknown error'}`)
    }

    /**
     * fetch remaining props (not stored on the article) from oc
     *
     * @param {object} conceptItem POJSO representation of a x-im concept
     *
     * @returns {object} conceptItem
     */
    async fetchConceptItemProperties(conceptItem) {
        const queryBuilder = new QueryBuilder({
            q: `uuid:${conceptItem.uuid}`,
            contenttype: this.contenttype
        })
            .setStart(0)
            .setLimit(1)
            .setResponseProperties(this.responseProperties)

        const builtQuery = queryBuilder.build()
        const items = await this.fetchItems(builtQuery)
        const props = items[0] ? items[0].versions[0].properties : {error: [404]}
        const convertedProps = this._convertProps(props)
        return Object.assign(conceptItem, convertedProps)
    }

    /**
     * Search for concepts
     *
     * @param {string|array} conceptTypes 'x-im/story' or ['x-im/tag', 'x-im/category']
     * @param {string} term the term to look for in Concept name and description
     * @param {object} subtypes ['position', 'polygon']
     *
     * @returns {array} response An array with result objects
     */
    async searchForConceptSuggestions(conceptTypes, term, subtypes) {
        let conceptTypeQuery, subtypesQuery = ''

        if (Array.isArray(conceptTypes)) {
            conceptTypeQuery = conceptTypes.reduce((query, type) => {
                if (!query.length) {
                    query = `(${this.propertyMap.ConceptImTypeFull}:${type}`
                } else {
                    query = `${query} OR ${this.propertyMap.ConceptImTypeFull}:${type}`
                }
                return query
            }, '')
            conceptTypeQuery = `${conceptTypeQuery})`
        } else {
            conceptTypeQuery = `${this.propertyMap.ConceptImTypeFull}:${conceptTypes}`
        }

        if (Array.isArray(subtypes)) {
            subtypesQuery = subtypes.reduce((query, subtype) => {
                if (!query.length) {
                    query = ` AND (${this.propertyMap.ConceptImSubTypeFull}:x-im/${subtype}`
                } else {
                    query = `${query} OR ${this.propertyMap.ConceptImSubTypeFull}:x-im/${subtype}`
                }
                return query
            }, '')
            subtypesQuery = `${subtypesQuery})`
        }

        /**
         * This is by design/request
         * This way items with term in title will be in the begining of the list (sorted)
         * Followed by items with term in description (sorted)
         */
        const titleItems = await this._search(conceptTypeQuery, subtypesQuery, ` AND ${this.propertyMap.ConceptName}:${term}*`)
        const notQuery = this._generateNotUuidsQuery(titleItems)

        const descriptionItems = await this._search(conceptTypeQuery, subtypesQuery, ` AND ${this.propertyMap.ConceptDefinitionShort}:*${term}*`, notQuery)
        const items = titleItems.concat(descriptionItems)

        const response = []
        items.forEach(item => {
            let props = item.versions[0].properties
            let convertedProps = this._convertProps(props)
            response.push(convertedProps)
        })

        return response
    }

    /**
     * Generate a query like: NOT uuid:(xxx, xxx...)
     *
     * @private
     * @param {array} excludeItems
     */
    _generateNotUuidsQuery(excludeItems) {
        const query = excludeItems.length ? excludeItems.reduce((query, item) => {
            return `${query}uuid:${item.id} OR `
        }, ' AND NOT (') : ''

        // Remove last " OR " and close the parenthesis
        const notQuery = `${query.slice(0, -4)})`
        return notQuery.trim().length > 1 ? notQuery : ''
    }

    /**
     * Combine all premade querys and do a search ba-proxy
     *
     * @param {string} conceptTypeQuery
     * @param {string} subtypesQuery
     * @param {string} termQuery
     * @param {string} notQuery
     */
    async _search(conceptTypeQuery, subtypesQuery, termQuery, notQuery = '') {
        const queryBuilder = new QueryBuilder({
            q: `${conceptTypeQuery}${subtypesQuery}${termQuery}${notQuery}`,
            contenttype: this.contenttype
        })
        .setStart(0)
        .setLimit(this.searchLimit)
        .setSorting(this.sortField, true)
        .setResponseProperties(this.responseProperties)

        const builtQuery = queryBuilder.build()
        return await this.fetchItems(builtQuery)
    }
}

export default ConceptService
</code></pre>
        </article>
    </section>





</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Feb 23 2018 11:15:41 GMT+0100 (CET) using a modified version of the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>
<!-- <script src="scripts/prism.js"></script> -->
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
